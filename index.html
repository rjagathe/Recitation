<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acharya108 - Affordable Education for All</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            animation: fadeInDown 1s ease;
        }

        h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .tagline {
            font-size: 1.3em;
            font-style: italic;
            opacity: 0.9;
        }

        .content-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: fadeInUp 1s ease;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 3px solid #e0e0e0;
            flex-wrap: wrap;
        }

        .tab {
            padding: 15px 30px;
            background: #f5f5f5;
            border: none;
            border-radius: 10px 10px 0 0;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: all 0.3s ease;
            color: #555;
        }

        .tab:hover {
            background: #e0e0e0;
            transform: translateY(-2px);
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
        }

        .sub-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            padding-left: 20px;
            flex-wrap: wrap;
        }

        .sub-tab {
            padding: 10px 20px;
            background: #e3f2fd;
            border: 2px solid #2196F3;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #1976D2;
        }

        .sub-tab:hover {
            background: #2196F3;
            color: white;
            transform: scale(1.05);
        }

        .sub-tab.active {
            background: #2196F3;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .float-button {
            padding: 20px;
            background: linear-gradient(145deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.4s ease;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .float-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.6);
        }

        .float-button.disabled {
            background: #cccccc;
            cursor: not-allowed;
            box-shadow: none;
        }

        .breadcrumb {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 600;
            color: #555;
        }

        .question-list {
            list-style: none;
        }

        .question-item {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            margin: 15px 0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #667eea;
        }

        .question-item:hover {
            transform: translateX(10px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .section-title {
            font-size: 1.5em;
            color: #667eea;
            margin: 30px 0 20px 0;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .back-button {
            background: #ff6b6b;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: #ff5252;
            transform: translateY(-2px);
        }

        .learning-interface {
            display: none;
        }

        .learning-interface.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .question-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .question-header h2 {
            font-size: 1.8em;
            margin-bottom: 10px;
        }

        .level-selector {
            display: flex;
            gap: 10px;
            margin: 25px 0;
            flex-wrap: wrap;
        }

        .level-btn {
            flex: 1;
            min-width: 100px;
            padding: 15px;
            border: 3px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .level-btn:hover {
            background: #f0f0f0;
            transform: translateY(-2px);
        }

        .level-btn.active {
            background: #667eea;
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .answer-display {
            background: #f9f9f9;
            padding: 30px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 5px solid #667eea;
            line-height: 1.8;
            font-size: 1.1em;
        }

        .answer-display h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .key-terms {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #ffc107;
        }

        .recite-section {
            display: none;
            margin-top: 30px;
        }

        .recite-section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .timer-display {
            text-align: center;
            font-size: 3em;
            color: #667eea;
            font-weight: bold;
            margin: 20px 0;
        }

        .timer-display.warning {
            color: #ff9800;
        }

        .timer-display.danger {
            color: #f44336;
            animation: pulse 1s infinite;
        }

        .input-mode-toggle {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }

        .mode-btn {
            padding: 12px 25px;
            background: white;
            border: 3px solid #667eea;
            color: #667eea;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mode-btn.active {
            background: #667eea;
            color: white;
        }

        .voice-input-area {
            background: #f0f4ff;
            padding: 30px;
            border-radius: 12px;
            border: 3px dashed #667eea;
            text-align: center;
        }

        .keyboard-input-area {
            background: #f0f4ff;
            padding: 30px;
            border-radius: 12px;
            border: 3px solid #667eea;
            display: none;
        }

        .keyboard-input-area.active {
            display: block;
        }

        .mic-button {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(145deg, #667eea, #764ba2);
            border: none;
            color: white;
            font-size: 3em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
            margin: 20px auto;
            display: block;
        }

        .mic-button:hover {
            transform: scale(1.1);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.6);
        }

        .mic-button.recording {
            background: #f44336;
            animation: pulse 1.5s infinite;
        }

        .mic-button.paused {
            background: #ff9800;
        }

        .transcription-box {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            min-height: 150px;
            border: 2px solid #667eea;
            text-align: left;
            font-size: 1.1em;
            line-height: 1.6;
            max-height: 300px;
            overflow-y: auto;
        }

        .text-input-area {
            width: 100%;
            min-height: 200px;
            padding: 20px;
            border: 2px solid #667eea;
            border-radius: 10px;
            font-size: 1.1em;
            line-height: 1.6;
            font-family: inherit;
            resize: vertical;
        }

        .text-input-area:focus {
            outline: none;
            border-color: #764ba2;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
        }

        .recording-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .control-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
        }

        .control-btn.pause {
            background: #ff9800;
            color: white;
        }

        .control-btn.resume {
            background: #4caf50;
            color: white;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .primary-btn {
            padding: 15px 40px;
            background: linear-gradient(145deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .primary-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .secondary-btn {
            padding: 15px 40px;
            background: white;
            color: #667eea;
            border: 3px solid #667eea;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .secondary-btn:hover {
            background: #f0f0f0;
        }

        .feedback-section {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-top: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .feedback-section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .score-display {
            text-align: center;
            margin: 25px 0;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(145deg, #4caf50, #45a049);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            font-weight: bold;
            margin: 0 auto;
            box-shadow: 0 10px 30px rgba(76, 175, 80, 0.4);
        }

        .rubric-breakdown {
            background: #f9f9f9;
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 5px solid #667eea;
        }

        .rubric-item {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            background: white;
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
        }

        .rubric-item.found {
            border-color: #4caf50;
            background: #f1f8e9;
        }

        .rubric-item.partial {
            border-color: #ff9800;
            background: #fff3e0;
        }

        .rubric-item.missing {
            border-color: #f44336;
            background: #ffebee;
        }

        .rubric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .keyword-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            margin: 5px;
        }

        .keyword-badge.found {
            background: #4caf50;
            color: white;
        }

        .keyword-badge.missing {
            background: #f44336;
            color: white;
        }

        .comparison-view {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 25px 0;
        }

        .comparison-box {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }

        .comparison-box h4 {
            color: #667eea;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 1.2em;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2em;
            }
            .level-selector {
                flex-direction: column;
            }
            .comparison-view {
                grid-template-columns: 1fr;
            }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .highlight-text {
            background: yellow;
            padding: 2px 4px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéì Acharya108</h1>
            <p class="tagline">Affordable Education for All - Advanced Learning with AI Evaluation</p>
        </header>

        <div class="content-card">
            <div id="breadcrumb" class="breadcrumb">Home</div>
            
            <button id="backBtn" class="back-button" style="display: none;">‚Üê Back</button>

            <div class="tabs">
                <button class="tab" data-tab="cbse">CBSE</button>
                <button class="tab active" data-tab="tn">TN State Board</button>
            </div>

            <div id="cbse-content" class="tab-content">
                <p style="text-align: center; padding: 40px; color: #999; font-size: 1.2em;">
                    CBSE content coming soon...
                </p>
            </div>

            <div id="tn-content" class="tab-content active">
                <div class="sub-tabs">
                    <button class="sub-tab active" data-medium="english">English Medium</button>
                    <button class="sub-tab" data-medium="tamil">Tamil Medium</button>
                </div>

                <div id="english-medium" class="tab-content active">
                    <div id="grade-selection">
                        <h3 style="margin-bottom: 20px; color: #333;">Select Grade:</h3>
                        <div class="button-grid">
                            <button class="float-button" data-grade="6">Grade 6</button>
                            <button class="float-button" data-grade="7">Grade 7</button>
                            <button class="float-button" data-grade="8">Grade 8</button>
                            <button class="float-button" data-grade="9">Grade 9</button>
                            <button class="float-button" data-grade="10">Grade 10</button>
                            <button class="float-button" data-grade="11">Grade 11</button>
                            <button class="float-button" data-grade="12">Grade 12</button>
                        </div>
                    </div>

                    <div id="subject-selection" style="display: none;">
                        <h3 style="margin-bottom: 20px; color: #333;">Select Subject:</h3>
                        <div class="button-grid">
                            <button class="float-button" data-subject="tamil">Tamil</button>
                            <button class="float-button" data-subject="english">English</button>
                            <button class="float-button" data-subject="science">Science</button>
                            <button class="float-button" data-subject="social">Social Studies</button>
                        </div>
                    </div>

                    <div id="lesson-selection" style="display: none;">
                        <h3 style="margin-bottom: 20px; color: #333;">Select Lesson:</h3>
                        <div class="button-grid">
                            <button class="float-button" data-lesson="1">Lesson 1: Laws of Motion</button>
                            <button class="float-button disabled">Lesson 2: Coming Soon</button>
                            <button class="float-button disabled">Lesson 3: Coming Soon</button>
                            <button class="float-button disabled">Lesson 4: Coming Soon</button>
                        </div>
                    </div>

                    <div id="question-selection" style="display: none;">
                        <h3 class="section-title">üìù Brief Answer Questions</h3>
                        <ul class="question-list" id="brief-questions"></ul>

                        <h3 class="section-title">üìö Detailed Answer Questions</h3>
                        <ul class="question-list" id="detailed-questions"></ul>
                    </div>

                    <div id="learning-interface" class="learning-interface">
                        <div class="question-header">
                            <h2 id="current-question"></h2>
                            <p style="margin-top: 10px; opacity: 0.9;">Select a difficulty level and study the answer</p>
                        </div>

                        <div class="level-selector">
                            <button class="level-btn active" data-level="basic">Basic</button>
                            <button class="level-btn" data-level="elementary">Elementary</button>
                            <button class="level-btn" data-level="intermediate">Intermediate</button>
                            <button class="level-btn" data-level="advanced">Advanced</button>
                            <button class="level-btn" data-level="expert">Expert</button>
                        </div>

                        <div id="answer-display" class="answer-display">
                            <div class="loading">
                                <div class="spinner"></div>
                                <p>Loading answer...</p>
                            </div>
                        </div>

                        <div class="action-buttons">
                            <button class="primary-btn" onclick="startRecite()">üé§ Start Reciting</button>
                        </div>

                        <div id="recite-section" class="recite-section">
                            <div style="background: #fff3cd; padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #ffc107;">
                                <strong>üì¢ Instructions:</strong> Choose input mode below. You can speak (voice mode) or type (keyboard mode). Complete your answer and submit for detailed evaluation.
                            </div>

                            <div class="input-mode-toggle">
                                <button class="mode-btn active" onclick="switchInputMode('voice')">üé§ Voice Mode</button>
                                <button class="mode-btn" onclick="switchInputMode('keyboard')">‚å®Ô∏è Keyboard Mode</button>
                            </div>

                            <div id="voice-mode" class="voice-input-area">
                                <div class="timer-display" id="timer">3:00</div>
                                <h3 style="margin-bottom: 15px;">Click microphone to start/pause recording</h3>
                                <button class="mic-button" id="micBtn" onclick="toggleRecording()">üé§</button>
                                <p id="recording-status" style="color: #667eea; font-weight: bold; margin-bottom: 15px;">Ready to record</p>
                                
                                <div class="recording-controls" id="recordingControls" style="display: none;">
                                    <button class="control-btn pause" onclick="pauseRecording()">‚è∏Ô∏è Pause</button>
                                    <button class="control-btn resume" onclick="resumeRecording()" style="display: none;">‚ñ∂Ô∏è Resume</button>
                                </div>
                                
                                <div class="transcription-box" id="transcription">
                                    Your answer will appear here as you speak...
                                </div>
                            </div>

                            <div id="keyboard-mode" class="keyboard-input-area">
                                <h3 style="margin-bottom: 15px; color: #667eea;">Type your answer below:</h3>
                                <textarea id="textInput" class="text-input-area" placeholder="Start typing your answer here..."></textarea>
                            </div>

                            <div class="action-buttons">
                                <button class="secondary-btn" onclick="stopRecite()">Cancel</button>
                                <button class="primary-btn" onclick="submitForEvaluation()">‚úì Submit for Evaluation</button>
                            </div>
                        </div>

                        <div id="feedback-section" class="feedback-section">
                            <h2 style="color: #667eea; margin-bottom: 20px;">üìä Your Performance Report</h2>
                            
                            <div class="score-display">
                                <div class="score-circle" id="score-circle">85%</div>
                                <p style="margin-top: 15px; font-size: 1.2em; color: #666;">Overall Score</p>
                            </div>

                            <div id="feedback-text" style="margin-top: 25px;">
                                Loading evaluation...
                            </div>

                            <div class="action-buttons">
                                <button class="secondary-btn" onclick="tryAgain()">üîÑ Try Again</button>
                                <button class="primary-btn" onclick="nextQuestion()">Next Question ‚Üí</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="tamil-medium" class="tab-content">
                    <p style="text-align: center; padding: 40px; color: #999; font-size: 1.2em;">
                        Tamil Medium content coming soon...
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced evaluation rubrics for each question
        const evaluationRubrics = {
            "Define inertia. Give its classification.": {
                rubric: [
                    {
                        id: 1,
                        concept: "Definition of Inertia",
                        keywords: ["inertia", "property", "resist", "change", "motion", "state"],
                        requiredKeywords: ["inertia", "resist"],
                        points: 45,
                        description: "Property of an object to resist changes in its state of motion"
                    },
                    {
                        id: 2,
                        concept: "Classification Statement",
                        keywords: ["classified", "three", "types", "kinds", "categories"],
                        requiredKeywords: ["three", "types"],
                        points: 10,
                        description: "It is classified into three types"
                    },
                    {
                        id: 3,
                        concept: "Inertia of Rest",
                        keywords: ["rest", "stationary", "remain", "stay"],
                        requiredKeywords: ["rest"],
                        points: 15,
                        description: "Objects at rest stay at rest"
                    },
                    {
                        id: 4,
                        concept: "Inertia of Motion",
                        keywords: ["motion", "moving", "keep", "continue"],
                        requiredKeywords: ["motion"],
                        points: 15,
                        description: "Moving objects keep moving"
                    },
                    {
                        id: 5,
                        concept: "Inertia of Direction",
                        keywords: ["direction", "straight", "line", "path"],
                        requiredKeywords: ["direction"],
                        points: 15,
                        description: "Objects continue in the same direction"
                    }
                ],
                grammarPoints: 10
            },
            "Classify the types of force based on their application.": {
                rubric: [
                    {
                        id: 1,
                        concept: "Classification Statement",
                        keywords: ["classified", "two", "types", "kinds", "based", "application"],
                        requiredKeywords: ["two", "types"],
                        points: 10,
                        description: "Forces are classified into two types"
                    },
                    {
                        id: 2,
                        concept: "Contact Forces",
                        keywords: ["contact", "touch", "physical", "direct"],
                        requiredKeywords: ["contact"],
                        points: 20,
                        description: "Contact forces require physical touch"
                    },
                    {
                        id: 3,
                        concept: "Contact Force Examples",
                        keywords: ["friction", "tension", "normal", "applied"],
                        requiredKeywords: ["friction"],
                        points: 20,
                        description: "Examples: friction, tension, normal force"
                    },
                    {
                        id: 4,
                        concept: "Non-Contact Forces",
                        keywords: ["non-contact", "distance", "without", "touch", "field"],
                        requiredKeywords: ["non-contact"],
                        points: 20,
                        description: "Non-contact forces act at a distance"
                    },
                    {
                        id: 5,
                        concept: "Non-Contact Force Examples",
                        keywords: ["gravitational", "magnetic", "electrostatic", "gravity", "magnet"],
                        requiredKeywords: ["gravitational"],
                        points: 30,
                        description: "Examples: gravitational, magnetic, electrostatic"
                    }
                ],
                grammarPoints: 10
            }
        };

        // Questions database
        const questions = {
            brief: [
                "Define inertia. Give its classification.",
                "Classify the types of force based on their application.",
                "If a 5 Newton and a 15 Newton forces are acting opposite to one another. Find the resultant force and the direction of action of the resultant force",
                "Differentiate mass and weight.",
                "Define moment of a couple.",
                "State the principle of moments.",
                "State Newton's second law.",
                "Why a spanner with a long handle is preferred to tighten screws in heavy vehicles?",
                "While catching a cricket ball the fielder lowers his hands backwards. Why?",
                "How does an astronaut float in a space shuttle?"
            ],
            detailed: [
                "What are the types of inertia? Give an example for each type.",
                "State Newton's laws of motion?",
                "Deduce the equation of a force using Newton's second law of motion.",
                "State and prove the law of conservation of linear momentum.",
                "Describe rocket propulsion.",
                "State the universal law of gravitation and derive its mathematical expression",
                "Give the applications of universal law gravitation."
            ]
        };

        // Navigation state
        let currentState = {
            board: 'tn',
            medium: 'english',
            grade: null,
            subject: null,
            lesson: null,
            question: null,
            level: 'basic',
            isRecording: false,
            isPaused: false,
            recognition: null,
            timeRemaining: 180,
            timerInterval: null,
            userTranscript: '',
            currentAnswer: '',
            inputMode: 'voice'
        };

        // Initialize event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Tab switching
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    switchTab(this.dataset.tab);
                });
            });

            // Sub-tab switching
            document.querySelectorAll('.sub-tab').forEach(subTab => {
                subTab.addEventListener('click', function() {
                    switchMedium(this.dataset.medium);
                });
            });

            // Grade selection
            document.querySelectorAll('[data-grade]').forEach(btn => {
                btn.addEventListener('click', function() {
                    selectGrade(parseInt(this.dataset.grade));
                });
            });

            // Subject selection
            document.querySelectorAll('[data-subject]').forEach(btn => {
                btn.addEventListener('click', function() {
                    selectSubject(this.dataset.subject);
                });
            });

            // Lesson selection
            document.querySelectorAll('[data-lesson]:not(.disabled)').forEach(btn => {
                btn.addEventListener('click', function() {
                    selectLesson(parseInt(this.dataset.lesson));
                });
            });

            // Level buttons
            document.querySelectorAll('.level-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    selectLevel(this.dataset.level);
                });
            });

            // Back button
            document.getElementById('backBtn').addEventListener('click', goBack);

            // Initialize speech recognition
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                currentState.recognition = new SpeechRecognition();
                currentState.recognition.continuous = true;
                currentState.recognition.interimResults = true;
                currentState.recognition.lang = 'en-US';
                
                currentState.recognition.onresult = function(event) {
                    let transcript = '';
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        transcript += event.results[i][0].transcript + ' ';
                    }
                    currentState.userTranscript = transcript.trim();
                    document.getElementById('transcription').textContent = currentState.userTranscript || 'Your answer will appear here as you speak...';
                };

                currentState.recognition.onerror = function(event) {
                    console.error('Speech recognition error:', event.error);
                    if (event.error !== 'no-speech') {
                        document.getElementById('recording-status').textContent = 'Error: ' + event.error + ' - Click mic to try again';
                    }
                };

                currentState.recognition.onend = function() {
                    if (currentState.isRecording && !currentState.isPaused) {
                        try {
                            currentState.recognition.start();
                        } catch(e) {
                            console.log('Recognition restart handled');
                        }
                    }
                };
            }

            // Text input sync
            document.getElementById('textInput').addEventListener('input', function() {
                currentState.userTranscript = this.value;
            });
        });

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.tab === tabName) {
                    tab.classList.add('active');
                }
            });

            document.querySelectorAll('#cbse-content, #tn-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName + '-content').classList.add('active');

            currentState.board = tabName;
            updateBreadcrumb();
        }

        function switchMedium(medium) {
            document.querySelectorAll('.sub-tab').forEach(subTab => {
                subTab.classList.remove('active');
                if (subTab.dataset.medium === medium) {
                    subTab.classList.add('active');
                }
            });

            document.getElementById('english-medium').classList.remove('active');
            document.getElementById('tamil-medium').classList.remove('active');
            document.getElementById(medium + '-medium').classList.add('active');

            currentState.medium = medium;
            updateBreadcrumb();
        }

        function selectGrade(grade) {
            if (grade !== 10) {
                alert('Only Grade 10 Science content is currently available!');
                return;
            }
            currentState.grade = grade;
            document.getElementById('grade-selection').style.display = 'none';
            document.getElementById('subject-selection').style.display = 'block';
            updateBreadcrumb();
        }

        function selectSubject(subject) {
            if (subject !== 'science') {
                alert('Only Science content is currently available!');
                return;
            }
            currentState.subject = subject;
            document.getElementById('subject-selection').style.display = 'none';
            document.getElementById('lesson-selection').style.display = 'block';
            updateBreadcrumb();
        }

        function selectLesson(lessonNum) {
            currentState.lesson = lessonNum;
            document.getElementById('lesson-selection').style.display = 'none';
            document.getElementById('question-selection').style.display = 'block';
            
            loadQuestions();
            updateBreadcrumb();
        }

        function loadQuestions() {
            const briefList = document.getElementById('brief-questions');
            const detailedList = document.getElementById('detailed-questions');
            
            briefList.innerHTML = '';
            detailedList.innerHTML = '';
            
            questions.brief.forEach((q, index) => {
                const li = document.createElement('li');
                li.className = 'question-item';
                li.innerHTML = `
                    <div style="font-weight: bold; color: #667eea; margin-bottom: 8px;">Question ${index + 1}</div>
                    <div style="font-size: 1.1em;">${q}</div>
                `;
                li.onclick = () => selectQuestion(q, 'brief');
                briefList.appendChild(li);
            });
            
            questions.detailed.forEach((q, index) => {
                const li = document.createElement('li');
                li.className = 'question-item';
                li.innerHTML = `
                    <div style="font-weight: bold; color: #667eea; margin-bottom: 8px;">Question ${index + 1}</div>
                    <div style="font-size: 1.1em;">${q}</div>
                `;
                li.onclick = () => selectQuestion(q, 'detailed');
                detailedList.appendChild(li);
            });
        }

        function selectQuestion(question, type) {
            currentState.question = { text: question, type: type };
            
            document.getElementById('question-selection').style.display = 'none';
            document.getElementById('learning-interface').classList.add('active');
            document.getElementById('current-question').textContent = question;
            
            loadAnswer();
            updateBreadcrumb();
        }

        function selectLevel(level) {
            currentState.level = level;
            document.querySelectorAll('.level-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.level === level) {
                    btn.classList.add('active');
                }
            });
            
            loadAnswer();
        }

        function loadAnswer() {
            const answerDisplay = document.getElementById('answer-display');
            answerDisplay.innerHTML = '<div class="loading"><div class="spinner"></div><p>Generating answer...</p></div>';

            setTimeout(() => {
                const answer = getDemoAnswer(currentState.level);
                currentState.currentAnswer = answer;
                
                answerDisplay.innerHTML = `
                    <h3>üìñ ${currentState.level.charAt(0).toUpperCase() + currentState.level.slice(1)} Level Answer</h3>
                    <p style="line-height: 2; margin-top: 15px;">${answer}</p>
                    <div class="key-terms">
                        <strong>üí° Study Tip:</strong> Read this answer carefully. Pay attention to key terms and concepts. Try to memorize the structure and main points before reciting.
                    </div>
                `;
            }, 800);
        }

        function getDemoAnswer(level) {
            const question = currentState.question.text;
            
            const answers = {
                "Define inertia. Give its classification.": {
                    basic: "Inertia is the property of an object to resist changes in its state of motion. It is classified into three types: inertia of rest (objects at rest stay at rest), inertia of motion (moving objects keep moving), and inertia of direction (objects continue in the same direction).",
                    elementary: "Inertia is the tendency of a body to maintain its state of rest or uniform motion. The three types are: (1) Inertia of rest - objects at rest tend to stay at rest unless acted upon by an external force. (2) Inertia of motion - moving objects tend to keep moving at the same speed and direction. (3) Inertia of direction - objects moving in a straight line tend to continue in that direction unless disturbed.",
                    intermediate: "Inertia is a fundamental property of matter that describes the resistance of an object to any change in its velocity. This property is directly proportional to the mass of the object. The three classifications are: Inertia of rest keeps stationary objects stationary unless acted upon by external force. Inertia of motion maintains constant velocity in moving objects. Inertia of direction preserves the direction of motion unless external force intervenes.",
                    advanced: "Inertia represents the quantitative measure of an object's resistance to acceleration, directly proportional to its mass as described in Newton's First Law of Motion. The three types are: (1) Inertia of rest - exemplified by a book remaining on a table until an external force is applied. (2) Inertia of motion - demonstrated when passengers lurch forward during sudden braking. (3) Inertia of direction - observed when a stone tied to a string moves tangentially upon release.",
                    expert: "Inertia is an intrinsic property of matter that manifests as resistance to changes in velocity, mathematically represented by mass in Newton's second law (F=ma). The classification reflects different observational frames: Static inertia (rest) derives from molecular forces maintaining positional equilibrium. Kinetic inertia (motion) reflects momentum conservation (p=mv). Directional inertia emerges from vector properties of velocity, requiring centripetal force (F=mv¬≤/r) for circular motion."
                },
                "Classify the types of force based on their application.": {
                    basic: "Forces are classified into two types based on application: Contact forces require physical touch between objects (examples: friction, tension, normal force). Non-contact forces act at a distance without physical contact (examples: gravitational force, magnetic force, electrostatic force).",
                    elementary: "Based on application, forces are classified into: (1) Contact Forces - These forces act only when objects are in physical contact. Examples include friction, tension, normal force, and applied force. (2) Non-Contact Forces - These forces can act even without physical touch. Examples include gravitational force, magnetic force, and electrostatic force.",
                    intermediate: "Forces are categorized based on their mode of application: Contact forces require direct physical interaction. These include friction (opposes motion), normal force (perpendicular to surface), tension (through rope/string), and air resistance. Non-contact or field forces act through space without direct contact. These include gravitational force (universal attraction between masses), electromagnetic force (between charged particles), and nuclear forces.",
                    advanced: "Classification of forces based on application yields two fundamental categories: Contact forces arise from electromagnetic interactions at the molecular level. These include friction (static and kinetic), normal force (electromagnetic repulsion), tension (internal cohesive forces), and viscous forces. Non-contact forces represent fundamental interactions: gravitational force (infinite range, always attractive), electromagnetic force (infinite range, attractive or repulsive), strong nuclear force (binding nucleons), and weak nuclear force (radioactive decay).",
                    expert: "Force classification reflects four fundamental interactions. Contact forces are macroscopic manifestations of electromagnetic interaction at quantum level. Friction emerges from van der Waals forces and mechanical interlocking. Normal force represents Pauli exclusion principle. Non-contact forces include: Gravitation (field theory by general relativity), Electromagnetic (photon-mediated, unified by QED), Strong force (gluon-mediated, QCD), Weak force (W¬±, Z‚Å∞ bosons, electroweak unification)."
                }
            };

            const defaultAnswers = {
                basic: "This is a basic level answer providing fundamental understanding. It includes key definitions and simple explanations suitable for beginners.",
                elementary: "This elementary answer builds on basic concepts with detailed explanations, examples, and breaks down the concept into understandable parts.",
                intermediate: "This intermediate answer provides comprehensive coverage with scientific explanations, formulas, and practical applications requiring good understanding of fundamentals.",
                advanced: "This advanced answer includes in-depth scientific reasoning, mathematical derivations, and real-world applications demonstrating mastery of the subject.",
                expert: "This expert answer provides exhaustive analysis with quantum mechanical considerations, advanced mathematical formulations, and connections to cutting-edge research."
            };

            if (answers[question] && answers[question][level]) {
                return answers[question][level];
            }
            return defaultAnswers[level];
        }

        function switchInputMode(mode) {
            currentState.inputMode = mode;
            
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            if (mode === 'voice') {
                document.getElementById('voice-mode').style.display = 'block';
                document.getElementById('keyboard-mode').classList.remove('active');
                
                // Sync text input to transcription if switching modes
                if (currentState.userTranscript) {
                    document.getElementById('transcription').textContent = currentState.userTranscript;
                }
            } else {
                document.getElementById('voice-mode').style.display = 'none';
                document.getElementById('keyboard-mode').classList.add('active');
                
                // Stop any recording
                if (currentState.isRecording) {
                    toggleRecording();
                }
                
                // Sync transcription to text input
                document.getElementById('textInput').value = currentState.userTranscript || '';
            }
        }

        function startRecite() {
            document.getElementById('answer-display').style.display = 'none';
            document.getElementById('recite-section').classList.add('active');
            
            // Reset
            currentState.userTranscript = '';
            currentState.timeRemaining = 180;
            currentState.isRecording = false;
            currentState.isPaused = false;
            document.getElementById('transcription').textContent = 'Your answer will appear here as you speak...';
            document.getElementById('textInput').value = '';
            document.getElementById('recording-status').textContent = 'Ready to record. Click the microphone!';
            document.getElementById('micBtn').classList.remove('recording', 'paused');
            document.getElementById('recordingControls').style.display = 'none';
            updateTimer();
        }

        function toggleRecording() {
            const micBtn = document.getElementById('micBtn');
            const status = document.getElementById('recording-status');
            const controls = document.getElementById('recordingControls');
            
            if (!currentState.recognition) {
                alert('üé§ Speech recognition is not supported in your browser.\n\nPlease use Chrome, Edge, or Safari for voice recording feature.');
                return;
            }
            
            if (!currentState.isRecording) {
                // Start recording
                try {
                    currentState.recognition.start();
                    currentState.isRecording = true;
                    currentState.isPaused = false;
                    micBtn.classList.add('recording');
                    micBtn.classList.remove('paused');
                    status.textContent = 'üî¥ Recording... Speak now!';
                    controls.style.display = 'flex';
                    
                    // Start timer
                    currentState.timerInterval = setInterval(() => {
                        currentState.timeRemaining--;
                        updateTimer();
                        
                        if (currentState.timeRemaining <= 0) {
                            toggleRecording();
                            alert('‚è∞ Time is up! Your answer has been recorded.');
                        }
                    }, 1000);
                } catch (error) {
                    console.error('Failed to start recording:', error);
                    status.textContent = 'Error starting recording. Please try again.';
                }
            } else {
                // Stop recording completely
                try {
                    currentState.recognition.stop();
                } catch (error) {
                    console.error('Error stopping recognition:', error);
                }
                currentState.isRecording = false;
                currentState.isPaused = false;
                micBtn.classList.remove('recording', 'paused');
                status.textContent = '‚úì Recording stopped. Your answer is saved. Click Submit to evaluate.';
                controls.style.display = 'none';
                
                if (currentState.timerInterval) {
                    clearInterval(currentState.timerInterval);
                }
            }
        }

        function pauseRecording() {
            if (!currentState.isRecording) return;
            
            try {
                currentState.recognition.stop();
            } catch(e) {}
            
            currentState.isPaused = true;
            document.getElementById('micBtn').classList.remove('recording');
            document.getElementById('micBtn').classList.add('paused');
            document.getElementById('recording-status').textContent = '‚è∏Ô∏è Paused. Click Resume to continue.';
            
            document.querySelector('.control-btn.pause').style.display = 'none';
            document.querySelector('.control-btn.resume').style.display = 'block';
            
            if (currentState.timerInterval) {
                clearInterval(currentState.timerInterval);
            }
        }

        function resumeRecording() {
            if (!currentState.isRecording) return;
            
            try {
                currentState.recognition.start();
            } catch(e) {}
            
            currentState.isPaused = false;
            document.getElementById('micBtn').classList.add('recording');
            document.getElementById('micBtn').classList.remove('paused');
            document.getElementById('recording-status').textContent = 'üî¥ Recording... Speak now!';
            
            document.querySelector('.control-btn.pause').style.display = 'block';
            document.querySelector('.control-btn.resume').style.display = 'none';
            
            // Restart timer
            currentState.timerInterval = setInterval(() => {
                currentState.timeRemaining--;
                updateTimer();
                
                if (currentState.timeRemaining <= 0) {
                    toggleRecording();
                    alert('‚è∞ Time is up!');
                }
            }, 1000);
        }

        function updateTimer() {
            const minutes = Math.floor(currentState.timeRemaining / 60);
            const seconds = currentState.timeRemaining % 60;
            const display = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            const timerEl = document.getElementById('timer');
            timerEl.textContent = display;
            
            timerEl.classList.remove('warning', 'danger');
            if (currentState.timeRemaining <= 30) {
                timerEl.classList.add('danger');
            } else if (currentState.timeRemaining <= 60) {
                timerEl.classList.add('warning');
            }
        }

        function stopRecite() {
            if (currentState.isRecording) {
                toggleRecording();
            }
            if (currentState.timerInterval) {
                clearInterval(currentState.timerInterval);
            }
            
            document.getElementById('recite-section').classList.remove('active');
            document.getElementById('answer-display').style.display = 'block';
            
            currentState.userTranscript = '';
            document.getElementById('transcription').textContent = 'Your answer will appear here as you speak...';
            document.getElementById('textInput').value = '';
            document.getElementById('recording-status').textContent = 'Ready to record';
            document.getElementById('micBtn').classList.remove('recording', 'paused');
        }

        function submitForEvaluation() {
            // Get answer from active input mode
            if (currentState.inputMode === 'keyboard') {
                currentState.userTranscript = document.getElementById('textInput').value;
            }
            
            if (!currentState.userTranscript || currentState.userTranscript.trim().length < 10) {
                alert('‚ö†Ô∏è Please provide your answer before submitting!\n\nYour answer is too short. Please elaborate more on the topic.');
                return;
            }

            if (currentState.isRecording) {
                toggleRecording();
            }

            document.getElementById('recite-section').classList.remove('active');
            document.getElementById('feedback-section').classList.add('active');
            
            document.getElementById('feedback-text').innerHTML = '<div class="loading"><div class="spinner"></div><p>Evaluating your answer with advanced rubrics...</p></div>';

            // Evaluate answer
            setTimeout(() => {
                const evaluation = evaluateAnswerWithRubrics(currentState.question.text, currentState.userTranscript);
                displayDetailedFeedback(evaluation);
            }, 1500);
        }

        function evaluateAnswerWithRubrics(question, userAnswer) {
            const rubric = evaluationRubrics[question];
            
            if (!rubric) {
                // Fallback to basic evaluation
                return {
                    score: 50,
                    rubricResults: [],
                    grammarScore: 5,
                    feedback: "Detailed rubric not available for this question. Basic evaluation applied."
                };
            }

            const lowerAnswer = userAnswer.toLowerCase();
            let totalScore = 0;
            let rubricResults = [];
            
            // Evaluate each rubric item
            rubric.rubric.forEach(item => {
                let itemScore = 0;
                let foundKeywords = [];
                let missingKeywords = [];
                let status = 'missing';
                
                // Check required keywords first
                const hasRequired = item.requiredKeywords.every(kw => 
                    lowerAnswer.includes(kw.toLowerCase())
                );
                
                if (hasRequired) {
                    // Check all keywords
                    item.keywords.forEach(keyword => {
                        if (lowerAnswer.includes(keyword.toLowerCase())) {
                            foundKeywords.push(keyword);
                        } else {
                            missingKeywords.push(keyword);
                        }
                    });
                    
                    // Calculate item score based on keyword coverage
                    const coverage = foundKeywords.length / item.keywords.length;
                    
                    if (coverage >= 0.7) {
                        itemScore = item.points;
                        status = 'found';
                    } else if (coverage >= 0.4) {
                        itemScore = item.points * 0.6;
                        status = 'partial';
                    } else {
                        itemScore = item.points * 0.3;
                        status = 'partial';
                    }
                } else {
                    // Required keywords missing
                    item.keywords.forEach(keyword => {
                        if (lowerAnswer.includes(keyword.toLowerCase())) {
                            foundKeywords.push(keyword);
                        } else {
                            missingKeywords.push(keyword);
                        }
                    });
                    
                    // Minimal partial credit
                    if (foundKeywords.length > 0) {
                        itemScore = item.points * 0.2;
                        status = 'partial';
                    }
                }
                
                totalScore += itemScore;
                
                rubricResults.push({
                    ...item,
                    earnedPoints: Math.round(itemScore * 10) / 10,
                    status: status,
                    foundKeywords: foundKeywords,
                    missingKeywords: missingKeywords
                });
            });
            
            // Grammar and structure evaluation (10 points)
            let grammarScore = 0;
            const sentences = userAnswer.split(/[.!?]+/).filter(s => s.trim().length > 10);
            const wordCount = userAnswer.trim().split(/\s+/).length;
            
            // Sentence structure (5 points)
            if (sentences.length >= 3) grammarScore += 5;
            else if (sentences.length >= 2) grammarScore += 3;
            else if (sentences.length >= 1) grammarScore += 1;
            
            // Word count adequacy (5 points)
            if (wordCount >= 30) grammarScore += 5;
            else if (wordCount >= 20) grammarScore += 3;
            else if (wordCount >= 10) grammarScore += 1;
            
            totalScore += grammarScore;
            
            return {
                score: Math.min(Math.round(totalScore), 100),
                rubricResults: rubricResults,
                grammarScore: grammarScore,
                wordCount: wordCount,
                sentenceCount: sentences.length,
                maxScore: rubric.rubric.reduce((sum, item) => sum + item.points, 0) + rubric.grammarPoints
            };
        }

        function displayDetailedFeedback(evaluation) {
            const scoreCircle = document.getElementById('score-circle');
            const feedbackText = document.getElementById('feedback-text');
            
            scoreCircle.textContent = evaluation.score + '%';
            
            // Color based on score
            if (evaluation.score >= 80) {
                scoreCircle.style.background = 'linear-gradient(145deg, #4caf50, #45a049)';
            } else if (evaluation.score >= 60) {
                scoreCircle.style.background = 'linear-gradient(145deg, #ff9800, #f57c00)';
            } else {
                scoreCircle.style.background = 'linear-gradient(145deg, #f44336, #d32f2f)';
            }
            
            let feedbackHTML = '';
            
            // Comparison view
            feedbackHTML += '<div class="comparison-view">';
            feedbackHTML += '<div class="comparison-box">';
            feedbackHTML += '<h4>üìù Your Answer</h4>';
            feedbackHTML += `<p style="line-height: 1.8; color: #333;">${currentState.userTranscript}</p>`;
            feedbackHTML += `<p style="margin-top: 15px; color: #666; font-size: 0.95em;">Words: ${evaluation.wordCount} | Sentences: ${evaluation.sentenceCount}</p>`;
            feedbackHTML += '</div>';
            
            feedbackHTML += '<div class="comparison-box">';
            feedbackHTML += '<h4>üìñ Expected Answer</h4>';
            feedbackHTML += `<p style="line-height: 1.8; color: #333;">${currentState.currentAnswer}</p>`;
            feedbackHTML += '</div>';
            feedbackHTML += '</div>';
            
            // Detailed rubric breakdown
            if (evaluation.rubricResults && evaluation.rubricResults.length > 0) {
                feedbackHTML += '<div class="rubric-breakdown">';
                feedbackHTML += '<h3 style="color: #667eea; margin-bottom: 20px;">üéØ Detailed Evaluation Breakdown</h3>';
                
                evaluation.rubricResults.forEach((result, index) => {
                    const percentage = Math.round((result.earnedPoints / result.points) * 100);
                    
                    feedbackHTML += `<div class="rubric-item ${result.status}">`;
                    feedbackHTML += '<div class="rubric-header">';
                    feedbackHTML += `<strong>${result.concept}</strong>`;
                    feedbackHTML += `<strong style="font-size: 1.2em;">${result.earnedPoints}/${result.points} (${percentage}%)</strong>`;
                    feedbackHTML += '</div>';
                    
                    feedbackHTML += `<p style="color: #666; margin: 10px 0;">${result.description}</p>`;
                    
                    if (result.foundKeywords.length > 0) {
                        feedbackHTML += '<div style="margin-top: 10px;">';
                        feedbackHTML += '<strong style="color: #4caf50;">‚úì Found Keywords:</strong><br>';
                        result.foundKeywords.forEach(kw => {
                            feedbackHTML += `<span class="keyword-badge found">${kw}</span>`;
                        });
                        feedbackHTML += '</div>';
                    }
                    
                    if (result.missingKeywords.length > 0) {
                        feedbackHTML += '<div style="margin-top: 10px;">';
                        feedbackHTML += '<strong style="color: #f44336;">‚úó Missing Keywords:</strong><br>';
                        result.missingKeywords.forEach(kw => {
                            feedbackHTML += `<span class="keyword-badge missing">${kw}</span>`;
                        });
                        feedbackHTML += '</div>';
                    }
                    
                    feedbackHTML += '</div>';
                });
                
                // Grammar score
                feedbackHTML += '<div class="rubric-item ' + (evaluation.grammarScore >= 8 ? 'found' : (evaluation.grammarScore >= 5 ? 'partial' : 'missing')) + '">';
                feedbackHTML += '<div class="rubric-header">';
                feedbackHTML += '<strong>Grammar & Structure</strong>';
                feedbackHTML += `<strong style="font-size: 1.2em;">${evaluation.grammarScore}/10</strong>`;
                feedbackHTML += '</div>';
                feedbackHTML += `<p style="color: #666; margin-top: 10px;">Sentence structure, word count, and overall presentation</p>`;
                feedbackHTML += '</div>';
                
                feedbackHTML += '</div>';
            }
            
            // Recommendations
            feedbackHTML += '<div style="background: #fff3cd; padding: 20px; border-radius: 10px; margin-top: 25px; border-left: 4px solid #ffc107;">';
            feedbackHTML += '<h4 style="color: #856404; margin-bottom: 15px;">üí° Recommendations for Improvement</h4>';
            feedbackHTML += '<ul style="margin-left: 20px; line-height: 1.8; color: #856404;">';
            
            if (evaluation.score >= 80) {
                feedbackHTML += '<li><strong>Excellent work!</strong> You demonstrated strong understanding of key concepts.</li>';
                feedbackHTML += '<li>Keep practicing to maintain this high level of performance.</li>';
            } else if (evaluation.score >= 60) {
                feedbackHTML += '<li><strong>Good effort!</strong> You covered several important points.</li>';
                feedbackHTML += '<li>Focus on including all required keywords and concepts mentioned in the expected answer.</li>';
            } else {
                feedbackHTML += '<li><strong>Keep practicing!</strong> Review the expected answer carefully.</li>';
                feedbackHTML += '<li>Pay special attention to the missing keywords highlighted above.</li>';
            }
            
            // Specific recommendations based on rubric
            const missingConcepts = evaluation.rubricResults.filter(r => r.status === 'missing' || r.earnedPoints < r.points * 0.5);
            if (missingConcepts.length > 0) {
                feedbackHTML += '<li><strong>Key concepts to study:</strong> ' + missingConcepts.map(c => c.concept).join(', ') + '</li>';
            }
            
            if (evaluation.wordCount < 20) {
                feedbackHTML += '<li>Try to elaborate more. Aim for at least 30-40 words for brief answers.</li>';
            }
            
            if (evaluation.sentenceCount < 3) {
                feedbackHTML += '<li>Structure your answer in multiple sentences for better clarity.</li>';
            }
            
            feedbackHTML += '</ul></div>';
            
            feedbackText.innerHTML = feedbackHTML;
        }

        function tryAgain() {
            document.getElementById('feedback-section').classList.remove('active');
            document.getElementById('answer-display').style.display = 'block';
            
            // Keep the previous answer visible for reference
            // Don't reset userTranscript
        }

        function nextQuestion() {
            document.getElementById('feedback-section').classList.remove('active');
            document.getElementById('learning-interface').classList.remove('active');
            document.getElementById('question-selection').style.display = 'block';
            
            currentState.question = null;
            currentState.userTranscript = '';
            currentState.level = 'basic';
            
            document.querySelectorAll('.level-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.level === 'basic') {
                    btn.classList.add('active');
                }
            });
            
            document.getElementById('transcription').textContent = 'Your answer will appear here as you speak...';
            document.getElementById('textInput').value = '';
            
            updateBreadcrumb();
        }

        function goBack() {
            if (currentState.question) {
                currentState.question = null;
                document.getElementById('learning-interface').classList.remove('active');
                document.getElementById('question-selection').style.display = 'block';
                document.getElementById('answer-display').style.display = 'block';
                document.getElementById('recite-section').classList.remove('active');
                document.getElementById('feedback-section').classList.remove('active');
                
                if (currentState.isRecording) {
                    toggleRecording();
                }
            } else if (currentState.lesson) {
                currentState.lesson = null;
                document.getElementById('question-selection').style.display = 'none';
                document.getElementById('lesson-selection').style.display = 'block';
            } else if (currentState.subject) {
                currentState.subject = null;
                document.getElementById('lesson-selection').style.display = 'none';
                document.getElementById('subject-selection').style.display = 'block';
            } else if (currentState.grade) {
                currentState.grade = null;
                document.getElementById('subject-selection').style.display = 'none';
                document.getElementById('grade-selection').style.display = 'block';
            }
            updateBreadcrumb();
        }

        function updateBreadcrumb() {
            let breadcrumbText = 'Home';
            
            if (currentState.board === 'tn') {
                breadcrumbText += ' > TN State Board';
            } else if (currentState.board === 'cbse') {
                breadcrumbText += ' > CBSE';
            }
            
            if (currentState.medium === 'english') {
                breadcrumbText += ' > English Medium';
            } else if (currentState.medium === 'tamil') {
                breadcrumbText += ' > Tamil Medium';
            }
            
            if (currentState.grade) {
                breadcrumbText += ' > Grade ' + currentState.grade;
            }
            
            if (currentState.subject) {
                breadcrumbText += ' > ' + currentState.subject.charAt(0).toUpperCase() + currentState.subject.slice(1);
            }
            
            if (currentState.lesson) {
                breadcrumbText += ' > Lesson ' + currentState.lesson;
            }

            if (currentState.question) {
                breadcrumbText += ' > Question';
            }
            
            document.getElementById('breadcrumb').textContent = breadcrumbText;
            document.getElementById('backBtn').style.display = (currentState.grade || currentState.question) ? 'block' : 'none';
        }
    </script>
</body>
</html>